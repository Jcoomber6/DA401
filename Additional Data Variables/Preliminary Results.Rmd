---
title: "How has the increased use of Telehealth in the US increased access to medical care for Medicare and Medicaid members?"
author: "Jessica Coomber"
institute: "Denison University"
format: 
  html:
    toc: true
    toc-location: left
    number-sections: true
    number-depth: 2
    theme: lux # Check here for more themes: https://quarto.org/docs/output-formats/html-themes.html
    code-tools: true
    code-fold: true
    code-summary: "Code"
    code-copy: hover
    link-external-newwindow: true
    tbl-cap-location: top
    fig-cap-location: bottom

self-contained: true
editor: source
---

```{r setup, include=FALSE}
# DO NOT EDIT THIS

knitr::opts_chunk$set(fig.align = 'center')
knitr::opts_chunk$set(out.width = '90%')
knitr::opts_chunk$set(results = 'hold')
knitr::opts_chunk$set(fig.show = 'hold')
knitr::opts_chunk$set(error = TRUE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
par(mar = c(4.1, 4.1, 1.1, 4.1))

hooks = knitr::knit_hooks$get()
hook_foldable = function(type) {
  force(type)
  function(x, options) {
    res = hooks[[type]](x, options)
    
    if (isFALSE(options[[paste0("fold.", type)]])) return(res)
    
    paste0(
      "<details open><summary>", gsub("^p", "P", gsub("^o", "O", type)), "</summary>\n\n",
      res,
      "\n\n</details>"
    )
  }
}

knitr::knit_hooks$set(
  output = hook_foldable("output"),
  plot = hook_foldable("plot")
)

Q <- 0
```

```{r include=FALSE}
q <- 0
```

# Introduction

## Research Question

How has the increased use of Telehealth in the US increased access to medical care for Medicare and Medicaid members?

## Problem Statement or Introduction

This research will examine how the increased use in telehealth has increased access to medical care for Medicare and Medicaid members. This research with reference demographic factors that suggest economic status of individuals to see how they are impacting the number of telehealth visits. 

I expect that disadvantaged populations will show a lower utilization of telehealth despite the potential of telehealth to improve access to care. I expect that socioeconomic factors affect the utilization of telehealth services and individuals with lower socioeconomic status will have lower uses of telehealth.


## Methods

I will be primarily working with the Medicare Telehealth Trends dataset published by the Centers for Medicare & Medicaid Services, made available on Data.gov. This dataset represents patients with Medicare and/or Medicaid who reported using telehealth services during and after the pandemic. This data will be merged with publicly available data from the US Census Bureau on state specific factors that could be impacting access to telehealth. 

U.S. Census Bureau variables that I will include are number of vehicles, types of internet subscriptions, number of hospitals and population for each state.

Variables that are available on FRED that I will merge based on the year include: the unemployment rate and GDP.

I will use a fixed effect analysis to see whether certain variables are having a strong impact on the number of telehealth visits. I will use state and year as my fixed effects because they are not changing with time. Fixed effect will be a beneficial method because it will help isolate variables of influence to see how they are impacting the utilization of telehealth services.


## Early Results

## Load Packages

```{r}
# Load necessary packages
library(caret)
library(modelsummary)
library(ggplot2)
library(dplyr)
library(tidyr)
library(fpp3)
library(tidyverse)
library(patchwork)
library(gganimate)
library(readxl)
library(forecast)
library(ggplot2)
library(purrr)
library(transformr) # Just to get it on renv
library(latex2exp)
library(scales)
library(tsibble)
library(fable)
library(fabletools)
library(FNN)
library(MASS)
```

# Cleaning the Data

## Telehealth Dataset

```{r}
# Telehealth Data Cleaning

# Load the data
Telehealth <- read.csv("Medicare Telehealth Trends.csv", header = TRUE, sep = ",")
# Remove all rows with any missing (NA) values
Telehealth <- na.omit(Telehealth)

```

```{r}
# Telehealth rename variables
Telehealth <- Telehealth %>% rename(Quarter = quarter)
Telehealth <- Telehealth %>% rename(State = Bene_Geo_Desc)
Telehealth <- Telehealth %>% rename(EnrollmentStatus = Bene_Mdcd_Mdcr_Enrl_Stus)
Telehealth <- Telehealth %>% rename(Race = Bene_Race_Desc)
Telehealth <- Telehealth %>% rename(Sex = Bene_Sex_Desc)
Telehealth <- Telehealth %>% rename(MedicareAccessForInsured = Bene_Mdcr_Entlmt_Stus)
Telehealth <- Telehealth %>% rename(Age = Bene_Age_Desc)
Telehealth <- Telehealth %>% rename(RuralUrban = Bene_RUCA_Desc)
Telehealth <- Telehealth %>% rename(EligibleServicesCount = Total_Bene_TH_Elig)
Telehealth <- Telehealth %>% rename(EnrollmentPartB = Total_PartB_Enrl)
Telehealth <- Telehealth %>% rename(TelehealthVisits = Total_Bene_Telehealth)
Telehealth <- Telehealth %>% rename(PercentTelehealthPartB = Pct_Telehealth)
```

## Population Dataset

```{r}
# Load the data
Population <- read.csv("Annual Estimates of the Resident Population for the United States.csv", header = TRUE, sep = ",")

# Remove leading dots from state names in both datasets
Population$State <- gsub("^\\.+", "", Population$State)

# Standardize 'District of Columbia' in both datasets to ensure a match
Population$State <- gsub("District of Columbia", "District of Columbia", Population$State)
Telehealth$State <- gsub("District Of Columbia", "District of Columbia", Telehealth$State)

Population <- Population %>%
  rename(
    BasePopulation2020 = Base.Population.April.2020,
    `2020POP` = X2020,
    `2021POP` = X2021,
    `2022POP` = X2022,
    `2023POP` = X2023,
    `2024POP` = X2024
  )

# Reshape Population: Convert wide format (multiple years as columns) to long format (single 'Year' and 'POP' columns)
Population_long <- Population %>%
  pivot_longer(cols = starts_with("20"), # Select columns with years
               names_to = "Year",
               values_to = "POP") %>%
  mutate(Year = as.numeric(gsub("POP", "", Year))) # Convert 'Year' to numeric

# Merge Telehealth and reshaped Population data on State and Year
TelehealthandPopulation <- merge(Telehealth, Population_long, by = c("State", "Year"), all = TRUE)

# Remove all rows with any missing (NA) values - includes States labeled National, Virgin Islands, Midwest, West, South, Northeast, Territories
TelehealthandPopulation <- na.omit(TelehealthandPopulation)

# Removing Columns that are Not Needed 
TelehealthandPopulation <- dplyr::select(TelehealthandPopulation, -BasePopulation2020)

```

## Cleaning Vehicle Datasets

### Vehicle 2023 

```{r}
Vehicle2023 <- read.csv("Tenure by Vehicles Available_2023.csv", header = TRUE, sep = ",")
```

```{r}
# Transpose using pivot_longer and pivot_wider
Vehicle_transposed2023 <- Vehicle2023 %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE)

# Store original column names as a new column
Vehicle_transposed2023 <- Vehicle_transposed2023 %>%
  mutate(Original_Column_Names = rownames(Vehicle_transposed2023))

# Set first row as column names
colnames(Vehicle_transposed2023) <- Vehicle_transposed2023[1, ]

# Remove the first row, keeping the new column names
Vehicle_transposed2023 <- Vehicle_transposed2023[-1, ] 

# Remove all non-letter characters from column names
colnames(Vehicle_transposed2023) <- gsub("[^A-Za-z]", "", colnames(Vehicle_transposed2023))

colnames(Vehicle_transposed2023) <- make.unique(colnames(Vehicle_transposed2023))

Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(State = LabelGrouping)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(TotalOwned = Owneroccupied)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(NoVehicleAvailable = Novehicleavailable)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(OneVehicleAvailable = vehicleavailable)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(TwoVehicleAvailable = vehiclesavailable)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(ThreeVehicleAvailable = vehiclesavailable.1)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(FourVehicleAvailable = vehiclesavailable.2)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(FiveOrMoreVehicleAvailable = ormorevehiclesavailable)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(TotalRent = Renteroccupied)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(NoRentVehicleAvailable = Novehicleavailable.1)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(OneRentVehicleAvailable = vehicleavailable.1)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(TwoRentVehicleAvailable = vehiclesavailable.3)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(ThreeRentVehicleAvailable = vehiclesavailable.4)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(FourRentVehicleAvailable = vehiclesavailable.5)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(FiveOrMoreRentVehicleAvailable = ormorevehiclesavailable.1)
Vehicle_transposed2023 <- Vehicle_transposed2023 %>% rename(TotalNumVehicles = Total)

```

```{r}
# Keep only rows with "Estimate" and remove "Margin.of.Error"
Vehicle_transposed2023 <- Vehicle_transposed2023[!grepl("Margin.of.Error", rownames(Vehicle_transposed2023)), ]

# Rename row names by removing "..Estimate"
rownames(Vehicle_transposed2023) <- gsub("\\.\\.Estimate", "", rownames(Vehicle_transposed2023))

Vehicle_transposed2023$State <- gsub("\\.\\.Estimate", "", Vehicle_transposed2023$State)

```

```{r}
Vehicle_transposed2023$State <- gsub("District.of.Columbia", "District of Columbia", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("Puerto.Rico", "Puerto Rico", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("West.Virginia", "West Virginia", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("New.Hampshire", "New Hampshire", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("North.Carolina", "North Carolina", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("South.Carolina", "South Carolina", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("Rhode.Island", "Rhode Island", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("North.Dakota", "North Dakota", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("South.Dakota", "South Dakota", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("New.Mexico", "New Mexico", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("New.Jersey", "New Jersey", Vehicle_transposed2023$State)
Vehicle_transposed2023$State <- gsub("New.York", "New York", Vehicle_transposed2023$State)
```

### Vehicle 2022

```{r}
Vehicle2022 <- read.csv("Tenure by Vehicles Available_2022.csv", header = TRUE, sep = ",")
```

```{r}
# Transpose using pivot_longer and pivot_wider
Vehicle_transposed2022 <- Vehicle2022 %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE)

# Store original column names as a new column
Vehicle_transposed2022 <- Vehicle_transposed2022 %>%
  mutate(Original_Column_Names = rownames(Vehicle_transposed2022))

# Set first row as column names
colnames(Vehicle_transposed2022) <- Vehicle_transposed2022[1, ]

# Remove the first row, keeping the new column names
Vehicle_transposed2022 <- Vehicle_transposed2022[-1, ] 

# Remove all non-letter characters from column names
colnames(Vehicle_transposed2022) <- gsub("[^A-Za-z]", "", colnames(Vehicle_transposed2022))

colnames(Vehicle_transposed2022) <- make.unique(colnames(Vehicle_transposed2022))

Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(State = LabelGrouping)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(TotalOwned = Owneroccupied)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(NoVehicleAvailable = Novehicleavailable)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(OneVehicleAvailable = vehicleavailable)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(TwoVehicleAvailable = vehiclesavailable)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(ThreeVehicleAvailable = vehiclesavailable.1)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(FourVehicleAvailable = vehiclesavailable.2)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(FiveOrMoreVehicleAvailable = ormorevehiclesavailable)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(TotalRent = Renteroccupied)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(NoRentVehicleAvailable = Novehicleavailable.1)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(OneRentVehicleAvailable = vehicleavailable.1)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(TwoRentVehicleAvailable = vehiclesavailable.3)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(ThreeRentVehicleAvailable = vehiclesavailable.4)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(FourRentVehicleAvailable = vehiclesavailable.5)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(FiveOrMoreRentVehicleAvailable = ormorevehiclesavailable.1)
Vehicle_transposed2022 <- Vehicle_transposed2022 %>% rename(TotalNumVehicles = Total)

```

```{r}
# Keep only rows with "Estimate" and remove "Margin.of.Error"
Vehicle_transposed2022 <- Vehicle_transposed2022[!grepl("Margin.of.Error", rownames(Vehicle_transposed2022)), ]

# Rename row names by removing "..Estimate"
rownames(Vehicle_transposed2022) <- gsub("\\.\\.Estimate", "", rownames(Vehicle_transposed2022))

Vehicle_transposed2022$State <- gsub("\\.\\.Estimate", "", Vehicle_transposed2022$State)

```

```{r}
Vehicle_transposed2022$State <- gsub("District.of.Columbia", "District of Columbia", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("Puerto.Rico", "Puerto Rico", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("West.Virginia", "West Virginia", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("New.Hampshire", "New Hampshire", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("North.Carolina", "North Carolina", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("South.Carolina", "South Carolina", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("Rhode.Island", "Rhode Island", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("North.Dakota", "North Dakota", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("South.Dakota", "South Dakota", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("New.Mexico", "New Mexico", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("New.Jersey", "New Jersey", Vehicle_transposed2022$State)
Vehicle_transposed2022$State <- gsub("New.York", "New York", Vehicle_transposed2022$State)
```


### Vehicle 2021

```{r}
Vehicle2021 <- read.csv("Tenure by Vehicles Available_2021.csv", header = TRUE, sep = ",")
```

```{r}
# Transpose using pivot_longer and pivot_wider
Vehicle_transposed2021 <- Vehicle2021 %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE)

# Store original column names as a new column
Vehicle_transposed2021 <- Vehicle_transposed2021 %>%
  mutate(Original_Column_Names = rownames(Vehicle_transposed2021))

# Set first row as column names
colnames(Vehicle_transposed2021) <- Vehicle_transposed2021[1, ]

# Remove the first row, keeping the new column names
Vehicle_transposed2021 <- Vehicle_transposed2021[-1, ] 

# Remove all non-letter characters from column names
colnames(Vehicle_transposed2021) <- gsub("[^A-Za-z]", "", colnames(Vehicle_transposed2021))

colnames(Vehicle_transposed2021) <- make.unique(colnames(Vehicle_transposed2021))

Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(State = LabelGrouping)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(TotalOwned = Owneroccupied)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(NoVehicleAvailable = Novehicleavailable)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(OneVehicleAvailable = vehicleavailable)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(TwoVehicleAvailable = vehiclesavailable)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(ThreeVehicleAvailable = vehiclesavailable.1)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(FourVehicleAvailable = vehiclesavailable.2)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(FiveOrMoreVehicleAvailable = ormorevehiclesavailable)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(TotalRent = Renteroccupied)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(NoRentVehicleAvailable = Novehicleavailable.1)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(OneRentVehicleAvailable = vehicleavailable.1)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(TwoRentVehicleAvailable = vehiclesavailable.3)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(ThreeRentVehicleAvailable = vehiclesavailable.4)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(FourRentVehicleAvailable = vehiclesavailable.5)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(FiveOrMoreRentVehicleAvailable = ormorevehiclesavailable.1)
Vehicle_transposed2021 <- Vehicle_transposed2021 %>% rename(TotalNumVehicles = Total)

```

```{r}
# Keep only rows with "Estimate" and remove "Margin.of.Error"
Vehicle_transposed2021 <- Vehicle_transposed2021[!grepl("Margin.of.Error", rownames(Vehicle_transposed2021)), ]

# Rename row names by removing "..Estimate"
rownames(Vehicle_transposed2021) <- gsub("\\.\\.Estimate", "", rownames(Vehicle_transposed2021))

Vehicle_transposed2021$State <- gsub("\\.\\.Estimate", "", Vehicle_transposed2021$State)

```

```{r}
Vehicle_transposed2021$State <- gsub("District.of.Columbia", "District of Columbia", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("Puerto.Rico", "Puerto Rico", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("West.Virginia", "West Virginia", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("New.Hampshire", "New Hampshire", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("North.Carolina", "North Carolina", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("South.Carolina", "South Carolina", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("Rhode.Island", "Rhode Island", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("North.Dakota", "North Dakota", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("South.Dakota", "South Dakota", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("New.Mexico", "New Mexico", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("New.Jersey", "New Jersey", Vehicle_transposed2021$State)
Vehicle_transposed2021$State <- gsub("New.York", "New York", Vehicle_transposed2021$State)
```

### Vehicle 2020

```{r}
Vehicle2020 <- read.csv("Tenure by Vehicles Available_2020.csv", header = TRUE, sep = ",")
```

```{r}
# Transpose using pivot_longer and pivot_wider
Vehicle_transposed2020 <- Vehicle2020 %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE)

# Store original column names as a new column
Vehicle_transposed2020 <- Vehicle_transposed2020 %>%
  mutate(Original_Column_Names = rownames(Vehicle_transposed2020))

# Set first row as column names
colnames(Vehicle_transposed2020) <- Vehicle_transposed2020[1, ]

# Remove the first row, keeping the new column names
Vehicle_transposed2020 <- Vehicle_transposed2020[-1, ] 

# Remove all non-letter characters from column names
colnames(Vehicle_transposed2020) <- gsub("[^A-Za-z]", "", colnames(Vehicle_transposed2020))

colnames(Vehicle_transposed2020) <- make.unique(colnames(Vehicle_transposed2020))

Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(State = LabelGrouping)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(TotalOwned = Owneroccupied)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(NoVehicleAvailable = Novehicleavailable)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(OneVehicleAvailable = vehicleavailable)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(TwoVehicleAvailable = vehiclesavailable)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(ThreeVehicleAvailable = vehiclesavailable.1)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(FourVehicleAvailable = vehiclesavailable.2)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(FiveOrMoreVehicleAvailable = ormorevehiclesavailable)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(TotalRent = Renteroccupied)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(NoRentVehicleAvailable = Novehicleavailable.1)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(OneRentVehicleAvailable = vehicleavailable.1)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(TwoRentVehicleAvailable = vehiclesavailable.3)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(ThreeRentVehicleAvailable = vehiclesavailable.4)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(FourRentVehicleAvailable = vehiclesavailable.5)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(FiveOrMoreRentVehicleAvailable = ormorevehiclesavailable.1)
Vehicle_transposed2020 <- Vehicle_transposed2020 %>% rename(TotalNumVehicles = Total)

```

```{r}
# Keep only rows with "Estimate" and remove "Margin.of.Error"
Vehicle_transposed2020 <- Vehicle_transposed2020[!grepl("Margin.of.Error", rownames(Vehicle_transposed2020)), ]

# Rename row names by removing "..Estimate"
rownames(Vehicle_transposed2020) <- gsub("\\.\\.Estimate", "", rownames(Vehicle_transposed2020))

Vehicle_transposed2020$State <- gsub("\\.\\.Estimate", "", Vehicle_transposed2020$State)

```

```{r}
Vehicle_transposed2020$State <- gsub("District.of.Columbia", "District of Columbia", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("Puerto.Rico", "Puerto Rico", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("West.Virginia", "West Virginia", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("New.Hampshire", "New Hampshire", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("North.Carolina", "North Carolina", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("South.Carolina", "South Carolina", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("Rhode.Island", "Rhode Island", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("North.Dakota", "North Dakota", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("South.Dakota", "South Dakota", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("New.Mexico", "New Mexico", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("New.Jersey", "New Jersey", Vehicle_transposed2020$State)
Vehicle_transposed2020$State <- gsub("New.York", "New York", Vehicle_transposed2020$State)
```

### Merging all the Vehicle transposed data
```{r}
# Remove 2024 from TelehealthandPopulation before merging
TelehealthandPopulation <- TelehealthandPopulation %>%
  filter(Year != 2024)
```


```{r}
# Create a list of the vehicle datasets
vehicle_data <- list(
  "2020" = Vehicle_transposed2020,
  "2021" = Vehicle_transposed2021,
  "2022" = Vehicle_transposed2022,
  "2023" = Vehicle_transposed2023
)

# Convert each year’s vehicle data into a long format and combine
Vehicle_long <- bind_rows(
  lapply(names(vehicle_data), function(year) {
    vehicle_data[[year]] %>%
      mutate(Year = as.numeric(year)) # Add the year as a column
  })
)

# Merge the reshaped Vehicle dataset with TelehealthandPopulation on State and Year
TelehealthandPopulation_Vehicle <- merge(TelehealthandPopulation, Vehicle_long, by = c("State", "Year"), all = TRUE)

```

## Cleaning Internet Datasets

### Internet 2023

```{r}
InternetSubs2023 <- read.csv("Presence and Types of Internet Subscriptions_2023.csv", header = TRUE, sep = ",")
```

```{r}
# Transpose using pivot_longer and pivot_wider
Internet_transposed2023 <- InternetSubs2023 %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE)

# Store original column names as a new column
Internet_transposed2023 <- Internet_transposed2023 %>%
  mutate(Original_Column_Names = rownames(Internet_transposed2023))

# Set first row as column names
colnames(Internet_transposed2023) <- Internet_transposed2023[1, ]

# Remove the first row, keeping the new column names
Internet_transposed2023 <- Internet_transposed2023[-1, ] 

# Remove all non-letter characters from column names
colnames(Internet_transposed2023) <- gsub("[^A-Za-z]", "", colnames(Internet_transposed2023))

colnames(Internet_transposed2023) <- make.unique(colnames(Internet_transposed2023))

```

```{r}
Internet_transposed2023 <- Internet_transposed2023 %>% rename(State = LabelGrouping)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(WithInternet = WithanInternetsubscription)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(DialUpNoInternetSubs = DialupwithnoothertypeofInternetsubscription)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(BroadBandAnyType = Broadbandofanytype)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(CellularData = Cellulardataplan)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(CellularDataAndAnotherType = CellulardataplanwithnoothertypeofInternetsubscription)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(CableFiberOrDSL = BroadbandsuchascablefiberopticorDSL)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(CableFiberOrDSLOnly = BroadbandsuchascablefiberopticorDSLwithnoothertypeofInternetsubscription)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(SatelliteInternet = SatelliteInternetservice)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(SatelliteInternetOnly = SatelliteInternetservicewithnoothertypeofInternetsubscription)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(OtherServiceOnly = OtherservicewithnoothertypeofInternetsubscription)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(InternetAccessNoSubscrition = Internetaccesswithoutasubscription)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(NoInternet = NoInternetaccess)
Internet_transposed2023 <- Internet_transposed2023 %>% rename(TotalWithInternet = Total)
```

```{r}
# Keep only rows with "Estimate" and remove "Margin.of.Error"
Internet_transposed2023 <- Internet_transposed2023[!grepl("Margin.of.Error", rownames(Internet_transposed2023)), ]

# Rename row names by removing "..Estimate"
rownames(Internet_transposed2023) <- gsub("\\.\\.Estimate", "", rownames(Internet_transposed2023))

Internet_transposed2023$State <- gsub("\\.\\.Estimate", "", Internet_transposed2023$State)
```

```{r}
Internet_transposed2023$State <- gsub("District.of.Columbia", "District of Columbia", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("Puerto.Rico", "Puerto Rico", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("West.Virginia", "West Virginia", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("New.Hampshire", "New Hampshire", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("North.Carolina", "North Carolina", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("South.Carolina", "South Carolina", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("Rhode.Island", "Rhode Island", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("North.Dakota", "North Dakota", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("South.Dakota", "South Dakota", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("New.Mexico", "New Mexico", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("New.Jersey", "New Jersey", Internet_transposed2023$State)
Internet_transposed2023$State <- gsub("New.York", "New York", Internet_transposed2023$State)
```

### Internet 2022

```{r}
InternetSubs2022 <- read.csv("Presence and Types of Internet Subscriptions_2022.csv", header = TRUE, sep = ",")
```

```{r}
# Transpose using pivot_longer and pivot_wider
Internet_transposed2022 <- InternetSubs2022 %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE)

# Store original column names as a new column
Internet_transposed2022 <- Internet_transposed2022 %>%
  mutate(Original_Column_Names = rownames(Internet_transposed2022))

# Set first row as column names
colnames(Internet_transposed2022) <- Internet_transposed2022[1, ]

# Remove the first row, keeping the new column names
Internet_transposed2022 <- Internet_transposed2022[-1, ] 

# Remove all non-letter characters from column names
colnames(Internet_transposed2022) <- gsub("[^A-Za-z]", "", colnames(Internet_transposed2022))

colnames(Internet_transposed2022) <- make.unique(colnames(Internet_transposed2022))

```

```{r}
Internet_transposed2022 <- Internet_transposed2022 %>% rename(State = LabelGrouping)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(WithInternet = WithanInternetsubscription)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(DialUpNoInternetSubs = DialupwithnoothertypeofInternetsubscription)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(BroadBandAnyType = Broadbandofanytype)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(CellularData = Cellulardataplan)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(CellularDataAndAnotherType = CellulardataplanwithnoothertypeofInternetsubscription)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(CableFiberOrDSL = BroadbandsuchascablefiberopticorDSL)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(CableFiberOrDSLOnly = BroadbandsuchascablefiberopticorDSLwithnoothertypeofInternetsubscription)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(SatelliteInternet = SatelliteInternetservice)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(SatelliteInternetOnly = SatelliteInternetservicewithnoothertypeofInternetsubscription)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(OtherServiceOnly = OtherservicewithnoothertypeofInternetsubscription)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(InternetAccessNoSubscrition = Internetaccesswithoutasubscription)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(NoInternet = NoInternetaccess)
Internet_transposed2022 <- Internet_transposed2022 %>% rename(TotalWithInternet = Total)
```

```{r}
# Keep only rows with "Estimate" and remove "Margin.of.Error"
Internet_transposed2022 <- Internet_transposed2022[!grepl("Margin.of.Error", rownames(Internet_transposed2022)), ]

# Rename row names by removing "..Estimate"
rownames(Internet_transposed2022) <- gsub("\\.\\.Estimate", "", rownames(Internet_transposed2022))

Internet_transposed2022$State <- gsub("\\.\\.Estimate", "", Internet_transposed2022$State)
```

```{r}
Internet_transposed2022$State <- gsub("District.of.Columbia", "District of Columbia", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("Puerto.Rico", "Puerto Rico", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("West.Virginia", "West Virginia", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("New.Hampshire", "New Hampshire", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("North.Carolina", "North Carolina", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("South.Carolina", "South Carolina", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("Rhode.Island", "Rhode Island", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("North.Dakota", "North Dakota", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("South.Dakota", "South Dakota", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("New.Mexico", "New Mexico", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("New.Jersey", "New Jersey", Internet_transposed2022$State)
Internet_transposed2022$State <- gsub("New.York", "New York", Internet_transposed2022$State)
```

### Internet 2021

```{r}
InternetSubs2021 <- read.csv("Presence and Types of Internet Subscriptions_2021.csv", header = TRUE, sep = ",")
```

```{r}
# Transpose using pivot_longer and pivot_wider
Internet_transposed2021 <- InternetSubs2021 %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE)

# Store original column names as a new column
Internet_transposed2021 <- Internet_transposed2021 %>%
  mutate(Original_Column_Names = rownames(Internet_transposed2021))

# Set first row as column names
colnames(Internet_transposed2021) <- Internet_transposed2021[1, ]

# Remove the first row, keeping the new column names
Internet_transposed2021 <- Internet_transposed2021[-1, ] 

# Remove all non-letter characters from column names
colnames(Internet_transposed2021) <- gsub("[^A-Za-z]", "", colnames(Internet_transposed2021))

colnames(Internet_transposed2021) <- make.unique(colnames(Internet_transposed2021))

```

```{r}
Internet_transposed2021 <- Internet_transposed2021 %>% rename(State = LabelGrouping)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(WithInternet = WithanInternetsubscription)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(DialUpNoInternetSubs = DialupwithnoothertypeofInternetsubscription)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(BroadBandAnyType = Broadbandofanytype)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(CellularData = Cellulardataplan)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(CellularDataAndAnotherType = CellulardataplanwithnoothertypeofInternetsubscription)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(CableFiberOrDSL = BroadbandsuchascablefiberopticorDSL)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(CableFiberOrDSLOnly = BroadbandsuchascablefiberopticorDSLwithnoothertypeofInternetsubscription)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(SatelliteInternet = SatelliteInternetservice)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(SatelliteInternetOnly = SatelliteInternetservicewithnoothertypeofInternetsubscription)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(OtherServiceOnly = OtherservicewithnoothertypeofInternetsubscription)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(InternetAccessNoSubscrition = Internetaccesswithoutasubscription)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(NoInternet = NoInternetaccess)
Internet_transposed2021 <- Internet_transposed2021 %>% rename(TotalWithInternet = Total)
```

```{r}
# Keep only rows with "Estimate" and remove "Margin.of.Error"
Internet_transposed2021 <- Internet_transposed2021[!grepl("Margin.of.Error", rownames(Internet_transposed2021)), ]

# Rename row names by removing "..Estimate"
rownames(Internet_transposed2021) <- gsub("\\.\\.Estimate", "", rownames(Internet_transposed2021))

Internet_transposed2021$State <- gsub("\\.\\.Estimate", "", Internet_transposed2021$State)
```

```{r}
Internet_transposed2021$State <- gsub("District.of.Columbia", "District of Columbia", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("Puerto.Rico", "Puerto Rico", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("West.Virginia", "West Virginia", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("New.Hampshire", "New Hampshire", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("North.Carolina", "North Carolina", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("South.Carolina", "South Carolina", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("Rhode.Island", "Rhode Island", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("North.Dakota", "North Dakota", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("South.Dakota", "South Dakota", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("New.Mexico", "New Mexico", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("New.Jersey", "New Jersey", Internet_transposed2021$State)
Internet_transposed2021$State <- gsub("New.York", "New York", Internet_transposed2021$State)
```

### Internet 2020

```{r}
InternetSubs2020 <- read.csv("Presence and Types of Internet Subscriptions_2020.csv", header = TRUE, sep = ",")
```

```{r}
# Transpose using pivot_longer and pivot_wider
Internet_transposed2020 <- InternetSubs2020 %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE)

# Store original column names as a new column
Internet_transposed2020 <- Internet_transposed2020 %>%
  mutate(Original_Column_Names = rownames(Internet_transposed2020))

# Set first row as column names
colnames(Internet_transposed2020) <- Internet_transposed2020[1, ]

# Remove the first row, keeping the new column names
Internet_transposed2020 <- Internet_transposed2020[-1, ] 

# Remove all non-letter characters from column names
colnames(Internet_transposed2020) <- gsub("[^A-Za-z]", "", colnames(Internet_transposed2020))

colnames(Internet_transposed2020) <- make.unique(colnames(Internet_transposed2020))

```

```{r}
Internet_transposed2020 <- Internet_transposed2020 %>% rename(State = LabelGrouping)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(WithInternet = WithanInternetsubscription)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(DialUpNoInternetSubs = DialupwithnoothertypeofInternetsubscription)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(BroadBandAnyType = Broadbandofanytype)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(CellularData = Cellulardataplan)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(CellularDataAndAnotherType = CellulardataplanwithnoothertypeofInternetsubscription)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(CableFiberOrDSL = BroadbandsuchascablefiberopticorDSL)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(CableFiberOrDSLOnly = BroadbandsuchascablefiberopticorDSLwithnoothertypeofInternetsubscription)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(SatelliteInternet = SatelliteInternetservice)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(SatelliteInternetOnly = SatelliteInternetservicewithnoothertypeofInternetsubscription)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(OtherServiceOnly = OtherservicewithnoothertypeofInternetsubscription)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(InternetAccessNoSubscrition = Internetaccesswithoutasubscription)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(NoInternet = NoInternetaccess)
Internet_transposed2020 <- Internet_transposed2020 %>% rename(TotalWithInternet = Total)
```

```{r}
# Keep only rows with "Estimate" and remove "Margin.of.Error"
Internet_transposed2020 <- Internet_transposed2020[!grepl("Margin.of.Error", rownames(Internet_transposed2020)), ]

# Rename row names by removing "..Estimate"
rownames(Internet_transposed2020) <- gsub("\\.\\.Estimate", "", rownames(Internet_transposed2020))

Internet_transposed2020$State <- gsub("\\.\\.Estimate", "", Internet_transposed2020$State)
```

```{r}
Internet_transposed2020$State <- gsub("District.of.Columbia", "District of Columbia", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("Puerto.Rico", "Puerto Rico", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("West.Virginia", "West Virginia", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("New.Hampshire", "New Hampshire", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("North.Carolina", "North Carolina", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("South.Carolina", "South Carolina", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("Rhode.Island", "Rhode Island", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("North.Dakota", "North Dakota", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("South.Dakota", "South Dakota", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("New.Mexico", "New Mexico", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("New.Jersey", "New Jersey", Internet_transposed2020$State)
Internet_transposed2020$State <- gsub("New.York", "New York", Internet_transposed2020$State)
```

## Merging all the Internet transposed data

```{r}
# Create a list of the vehicle datasets
Internet_data <- list(
  "2020" = Internet_transposed2020,
  "2021" = Internet_transposed2021,
  "2022" = Internet_transposed2022,
  "2023" = Internet_transposed2023
)

# Convert each year’s vehicle data into a long format and combine
Internet_long <- bind_rows(
  lapply(names(Internet_data), function(year) {
    Internet_data[[year]] %>%
      mutate(Year = as.numeric(year)) # Add the year as a column
  })
)

# Merge the reshaped Internet dataset with TelehealthandPopulation_Vehicle on State and Year
TelehealthandPopulation_VehicleInternet <- merge(TelehealthandPopulation_Vehicle, Internet_long, by = c("State", "Year"), all = TRUE)
```

### Convert new columns to numeric 

```{r}
# Convert columns from character to numeric
columns_to_convert <- c("POP", "TotalNumVehicles", "TotalOwned", 
                        "NoVehicleAvailable", "OneVehicleAvailable", 
                        "TwoVehicleAvailable", "ThreeVehicleAvailable", 
                        "FourVehicleAvailable", "FiveOrMoreVehicleAvailable", 
                        "TotalRent", "NoRentVehicleAvailable", 
                        "OneRentVehicleAvailable", "TwoRentVehicleAvailable", 
                        "ThreeRentVehicleAvailable", "FourRentVehicleAvailable", 
                        "FiveOrMoreRentVehicleAvailable", "TotalWithInternet", 
                        "WithInternet", "DialUpNoInternetSubs", 
                        "BroadBandAnyType", "CellularData", 
                        "CellularDataAndAnotherType", "CableFiberOrDSL", 
                        "CableFiberOrDSLOnly", "SatelliteInternet", 
                        "SatelliteInternetOnly", "OtherServiceOnly", 
                        "InternetAccessNoSubscrition", "NoInternet")

# Apply gsub to clean each column before conversion
TelehealthandPopulation_VehicleInternet[columns_to_convert] <- lapply(TelehealthandPopulation_VehicleInternet[columns_to_convert], function(x) {
  # Remove non-numeric characters
  cleaned_x <- gsub("[^0-9.-]", "", x)
  # Convert to numeric
  as.numeric(cleaned_x)
})

```

### Vehicles per 100k people variables

```{r}
#Create a new variable for TotalNumVehicles per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    TotalNumVehiclesPer100k = (TotalNumVehicles / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for TotalOwned per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    TotalOwnedPer100k = (TotalOwned / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for NoVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    NoVehicleAvailablePer100k = (NoVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for OneVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    OneVehicleAvailablePer100k = (OneVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for TwoVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    TwoVehicleAvailablePer100k = (TwoVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for ThreeVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    ThreeVehicleAvailablePer100k = (ThreeVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for FourVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    FourVehicleAvailablePer100k = (FourVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for FiveOrMoreVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    FiveOrMoreVehicleAvailablePer100k = (FiveOrMoreVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for TotalRent per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    TotalRentPer100k = (TotalRent / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for NoRentVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    NoRentVehicleAvailablePer100k = (NoRentVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for OneRentVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    OneRentVehicleAvailablePer100k = (OneRentVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for TwoRentVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    TwoRentVehicleAvailablePer100k = (TwoRentVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for ThreeRentVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    ThreeRentVehicleAvailablePer100k = (ThreeRentVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for FourRentVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    FourRentVehicleAvailablePer100k = (FourRentVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for FiveOrMoreRentVehicleAvailable per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    FiveOrMoreRentVehicleAvailablePer100k = (FiveOrMoreRentVehicleAvailable / POP) * 100000  # Normalize per 100,000 people
  )



```

### Internet per 100k people variables
```{r}

#Create a new variable for WithInternet per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    WithInternetPer100k = (WithInternet / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for DialUpNoInternetSubs per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    DialUpNoInternetSubsPer100k = (DialUpNoInternetSubs / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for BroadBandAnyType per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
    BroadBandAnyTypePer100k = (BroadBandAnyType / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for CellularData per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   CellularDataPer100k = (CellularData / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for CellularDataAndAnotherType per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   CellularDataAndAnotherTypePer100k = (CellularDataAndAnotherType / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for CableFiberOrDSL per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   CableFiberOrDSLPer100k = (CableFiberOrDSL / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for SatelliteInternet per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   SatelliteInternetPer100k = (SatelliteInternet / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for SatelliteInternetOnly per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   SatelliteInternetOnlyPer100k = (SatelliteInternetOnly / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for OtherServiceOnly per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   OtherServiceOnlyPer100k = (OtherServiceOnly / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for InternetAccessNoSubscrition per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   InternetAccessNoSubscritionPer100k = (InternetAccessNoSubscrition / POP) * 100000  # Normalize per 100,000 people
  )

#Create a new variable for NoInternet per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   NoInternetPer100k = (NoInternet / POP) * 100000  # Normalize per 100,000 people
  )



```

### Telehealth and Eligible per 100k variables

```{r}
#Create a new variable for TelehealthVisits per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   TelehealthVisitsPer100k = (TelehealthVisits / POP) * 100000  # Normalize per 100,000 people
  )


#Create a new variable for EligibleServicesCount per 100,000 people
TelehealthandPopulation_VehicleInternet <- TelehealthandPopulation_VehicleInternet %>%
  mutate(
   EligibleServicesCountPer100k = (EligibleServicesCount / POP) * 100000  # Normalize per 100,000 people
  )


```

## Cleaning Hospital Dataset

```{r}
Hospitals <- read.csv("CentersForMedicareAndMedicaidServicesFacilities Hospitals.csv", header = TRUE, sep = ",")
```

```{r}
# Remove all non-letter characters from column names
colnames(Hospitals) <- gsub("[^A-Za-z]", "", colnames(Hospitals))

# Removing Columns that are NA 
Hospitals <- dplyr::select(Hospitals, -NoofBeds, -NoofCertifiedBeds, -NoofMedicaidNursingBeds, -NoofSkilledNursingBeds, -NoofICFMRBeds, - NoofPhysicianAssistants, -NoofNursePractitioners, -NoofDirectCarePersonnel, -NoofOtherPersonnel, -EmployeeCount, -FederallyFundedHealthCenterIndicator, -RuralHealthCenterProviderNumber, -RuralHealthClinicIndicator)

# Removing Columns that are Not Needed 
Hospitals <- dplyr::select(Hospitals, -Telephone, -ZIPCode, -StreetAddress, - ProviderNo)

```

```{r}
# Remove rows where State is one of the specified territories
Hospitals <- Hospitals %>%
  filter(!State %in% c("U.S. Virgin Islands", "American Samoa", "Guam", "Northern Mariana Islands"))
```

### Create Hospital Count by State

```{r}

#Hospital count
Hospitals$hospital_count <- table(Hospitals$State)[Hospitals$State]

# Select the 'State' and 'hospital_count' columns from Hospitals
hospital_count_df <- Hospitals %>%
  group_by(State) %>%
  summarize(hospital_count = n())


# Merge the Hospital dataset with TelehealthandPopulation_VehicleInternet on State
TelehealthandPopulation_VehicleInternetHospital <- merge(TelehealthandPopulation_VehicleInternet, hospital_count_df, by = c("State"), all = TRUE)

```

### Hospital Count Per 100k

```{r}
#Create a new variable for NoInternet per 100,000 people
TelehealthandPopulation_VehicleInternetHospital <- TelehealthandPopulation_VehicleInternetHospital %>%
  mutate(
   HospitalCount100k = (hospital_count / POP) * 100000  # Normalize per 100,000 people
  )

```


# Exploration

### By Race
```{r}
# Create bar plot
TelehealthandPopulation_VehicleInternet %>%
    filter(Race != "All") %>%
  ggplot(aes(x = Race, y = TelehealthVisitsPer100k, fill = Race)) +
  geom_bar(stat = "identity") +
  labs(title = "Telehealth Visits by Race Category",
       x = "Race Category",
       y = "Number of Telehealth Visits (Per 100k people)") +
    scale_y_continuous(labels = scales::comma) +  # Format y-axis with full numbers and commas
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotates x-axis labels
```

```{r}
# Create bar plot
TelehealthandPopulation_VehicleInternet %>%
    filter(Race != "All") %>%
  ggplot(aes(x = Race, y = EligibleServicesCountPer100k, fill = Race)) +
  geom_bar(stat = "identity") +
  labs(title = "Eligible Services by Race Category",
       x = "Race Category",
       y = "Number of Eligible Services (Per 100k people)") +
    scale_y_continuous(labels = scales::comma) +  # Format y-axis with full numbers and commas
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotates x-axis labels
```

```{r}
TelehealthandPopulation_VehicleInternet %>%
  filter(Race != "All") %>%  # Exclude "All" from the dataset
  count(Race) %>%
  ggplot(aes(x = Race, y = n, fill = Race)) +  # 'n' is the count of each race
  geom_bar(stat = "identity") +
  labs(title = "Count of Each Race in Dataset",
       x = "Race",
       y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels if needed
```
### By Enrollment Status

```{r}
# Create bar plot
TelehealthandPopulation_VehicleInternet %>%
  filter(EnrollmentStatus != "All") %>%
  ggplot(aes(x = EnrollmentStatus, y = TelehealthVisitsPer100k, fill = EnrollmentStatus)) +
  geom_bar(stat = "identity") +
  labs(title = "Telehealth Visits by Enrollment Status",
       x = "Enrollment Status",
       y = "Number of Telehealth Visits (Per 100k people)") +
    scale_y_continuous(labels = scales::comma) +  # Format y-axis with full numbers and commas
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotates x-axis labels

```
### By Year

```{r}
# Create bar plot
TelehealthandPopulation_VehicleInternet %>%
  ggplot(aes(x = Year, y = TelehealthVisitsPer100k, fill = factor(Year))) +  # Assign unique color per year
  geom_bar(stat = "identity") +
  labs(title = "Telehealth Visits by Year",
       x = "Year",
       y = "Number of Telehealth Visits (Per 100k people)") +
    scale_y_continuous(labels = scales::comma) +  # Format y-axis with full numbers and commas
  theme_minimal()+
  theme(legend.position = "none")  # Remove the legend


```

```{r}
# Create bar plot
TelehealthandPopulation_VehicleInternet %>%
  ggplot(aes(x = Year, y = EligibleServicesCountPer100k, fill = factor(Year))) +
  geom_bar(stat = "identity") +
  labs(title = "Eligible Services by Year",
       x = "Year",
       y = "Number of Eligible Services (Per 100k People)") +
    scale_y_continuous(labels = scales::comma) +  # Format y-axis with full numbers and commas
  theme_minimal()

```

```{r}
TelehealthandPopulation_VehicleInternet %>%
  ggplot(aes(x = factor(Year), y = TelehealthVisitsPer100k, fill = factor(Quarter))) +  
  geom_bar(stat = "identity", position = "dodge") +  # Places Q1–Q4 next to each other for each Year
  labs(title = "Telehealth Visits by Quarter and Year",
       x = "Year",
       y = "Number of Telehealth Visits (Per 100k people)",
       fill = "Quarter") +
  scale_y_continuous(labels = scales::comma) +  # Format y-axis with commas
  scale_fill_brewer(palette = "Paired") +  # Use a high-contrast color palette
  theme_minimal()
```

### By State

```{r}
# Create bar plot
TelehealthandPopulation_VehicleInternetHospital %>%
  arrange(desc(TelehealthVisitsPer100k)) %>%  # Arrange in descending order
  ggplot(aes(x = fct_reorder(State, TelehealthVisitsPer100k, .desc = TRUE), y = TelehealthVisitsPer100k, fill = State)) +
  geom_bar(stat = "identity") +
  labs(title = "Telehealth Visits by State",
       x = "State",
       y = "Number of Telehealth Visits (per 100k people)") +
    scale_y_continuous(labels = scales::comma) +  # Format y-axis with full numbers and commas
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")  # Rotates x-axis labels and removes legend
```


```{r}
# Create bar plot of number of hospitals by state
TelehealthandPopulation_VehicleInternetHospital %>%
  arrange(desc(HospitalCount100k)) %>%  # Arrange in descending order
  ggplot(aes(x = fct_reorder(State, HospitalCount100k, .desc = TRUE), y = HospitalCount100k, fill = State)) +
  geom_bar(stat = "identity") +
  labs(title = "Number of Hospitals by State",
       x = "State",
       y = "Number of Hospitals (per 100k people)") +
    scale_y_continuous(labels = scales::comma) +  # Format y-axis with full numbers and commas
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")  # Rotates x-axis labels and removes legend

```

# Fixed Effect

## Race

```{r}

model1<-lm(TelehealthVisits~Race, TelehealthandPopulation_VehicleInternetHospital) # without Income fixed effects
model2 <- lm(TelehealthVisits~Race + State, TelehealthandPopulation_VehicleInternetHospital) # with State fixed effects
model3<-lm(TelehealthVisits~Race + State + Year, TelehealthandPopulation_VehicleInternetHospital) # with State and Year fixed effects

regz <- list(`No Fixed Effect` = model1,
             `State Fixed Effect` = model2,
             `State and Year Fixed Effect` = model3)

gofz <- c("nobs", "r.squared")

rowz <- as.data.frame(matrix(c('State Fixed Effects', "No", "Yes", "Yes",
                               "Year Fixed Effects", "No", "No", "Yes"),
                             byrow = T, nrow = 2)) # 2 rows
attr(rowz, 'position') <- c(3, 4) # rows 3 and 4

modelsummary(regz,
             title = "Effect of State and Year on Races' impact on Number of Telehelath Visits",
             estimate = "{estimate}{stars}",
             gof_map = gofz,
             add_rows = rowz,
             coef_map = NULL) # HOW CAN I GET THIS TO WORK

```

* No Fixed Effect R^2 = 0.051 suggests the number of telehealth visits is explained little by the race.

* State Fixed Effect R^2 = 0.370 suggests adding state fixed effects improves the model’s explanatory power slightly.

* State and Year Fixed Effect R^2 = 0.389 suggests including both state and year fixed effects improves the model even more, explaining more variation in number of telehealth visits due to race.

* When State and Year fixed effects are included, the relationship between race and telehealth visits changes from 45,862.248*** to 21,057,971.591***. This suggests that once controlling for these factors, the impact of race on the number of telehealth visits is stronger.

## With Internet

```{r}
model1<-lm(TelehealthVisits~WithInternet, TelehealthandPopulation_VehicleInternetHospital) # without Income fixed effects
model2 <- lm(TelehealthVisits~WithInternet + State, TelehealthandPopulation_VehicleInternetHospital) # with State fixed effects
model3<-lm(TelehealthVisits~WithInternet + State + Year, TelehealthandPopulation_VehicleInternetHospital) # with State and Year fixed effects

regz <- list(`No Fixed Effect` = model1,
             `State Fixed Effect` = model2,
             `State and Year Fixed Effect` = model3)

gofz <- c("nobs", "r.squared")

rowz <- as.data.frame(matrix(c('State Fixed Effects', "No", "Yes", "Yes",
                               "Year Fixed Effects", "No", "No", "Yes"),
                             byrow = T, nrow = 2)) # 2 rows
attr(rowz, 'position') <- c(3, 4) # rows 3 and 4

modelsummary(regz,
             title = "Effect of State and Year on WithInternet' impact on Number of Telehelath Visits",
             estimate = "{estimate}{stars}",
             gof_map = gofz,
             add_rows = rowz,
             coef_map = NULL) # HOW CAN I GET THIS TO WORK
```

* No Fixed Effect R^2 = 0.275 suggests the number of telehealth visits is explained little by having Internet Access

* State Fixed Effect R^2 = 0.349 suggests adding state fixed effects improves the model’s explanatory power

* State and Year Fixed Effect R^2 = 0.350 suggests including both state and year fixed effects improves the model even more, explaining more variation in number of telehealth visits due to having internet

* When State and Year fixed effects are included, the relationship between having internet and telehealth visits changes from -2,260.236*** to 7,037,323.145***. Without the fixed effect the relationship between internet access and telehealth visits seems negative (a decrease in visits when internet access is present). Once controlling for fixed effects, we see that the impact of having internet on the number of telehealth visits switches to positive and is stronger.
